<!DOCTYPE html>
<html>
<head>
	<title>Test Sound Generation</title>
</head>
<body>
    <a id='prev'></a>
    <span id='curr'></span>
    <a id='next'></a>

    <script src='../js/lib/jsfxr.js'></script>
		<script src="../js/init.js"></script>

		<script src="../js/dom.js"></script>
		<script src="../js/drawing.js"></script>
		<script src="../js/geometry.js"></script>
		<script src="../js/math.js"></script>
		<script src="../js/rand.js"></script>

    <script type="text/javascript">
        seed = 100
        if (document.location.search.length) {
            seed = parseInt(document.location.search.substr(1), 10);
        }
        r = $.getRandomNumberGenerator(seed)
        $.write($.getElementById('prev'), seed-1);
        $.getElementById('prev').href = 'beepboop.html?' + (seed-1)
        $.write($.getElementById('curr'), seed);
        $.write($.getElementById('next'), seed+1);
        $.getElementById('next').href = 'beepboop.html?' + (seed+1)

        getSound = () => {
            _masterVolume = 0.5;
    		_waveType = 0;
    		_startFrequency = 0.3;
    		_minFrequency = 0.0;
    		_slide = 0.0;
    		_deltaSlide = 0.0;
    		_squareDuty = 0.0;
    		_dutySweep = 0.0;

    		_vibratoDepth = 0.0;
    		_vibratoSpeed = 0.0;

    		_attackTime = 0.0;
    		_sustainTime = 0.3;
    		_decayTime = 0.4;
    		_sustainPunch = 0.0;

    		_lpFilterResonance = 0.0;
    		_lpFilterCutoff = 1.0;
    		_lpFilterCutoffSweep = 0.0;
    		_hpFilterCutoff = 0.0;
    		_hpFilterCutoffSweep = 0.0;

    		_phaserOffset = 0.0;
    		_phaserSweep = 0.0;

    		_repeatSpeed = 0.0;

    		_changeSpeed = 0.0;
    		_changeAmount = 0.0;

    		_waveType = $.floor(r() * 2);
    		if(_waveType == 0) _squareDuty = r() * 0.6;
    		_startFrequency = 0.2 +r() * 0.4;
    		_sustainTime = 0.1 + r() * 0.1;
    		_decayTime = r() * 0.2;
    		_hpFilterCutoff = 0.1;

             to4DP = (value) => {
    			if (value < 0.0001 && value > -0.0001) return undefined;
    			var string = '' + value;
    			var split = string.split(/\./);

    			if (split.length == 1) return string;
    			var out = split[0] + '.' + split[1].substr(0, 4);
    			while (out.match(/0$/)) out = out.substr(0, out.length - 1);

    			return parseFloat(out);
    		}

            getSettings = () => {
                return [
                    _waveType,
                    to4DP(_attackTime),
                    to4DP(_sustainTime),
                    to4DP(_sustainPunch),
                    to4DP(_decayTime),
                    to4DP(_startFrequency),
                    to4DP(_minFrequency),
                    to4DP(_slide),
                    to4DP(_deltaSlide),
                    to4DP(_vibratoDepth),
                    to4DP(_vibratoSpeed),
                    to4DP(_changeAmount),
                    to4DP(_changeSpeed),
                    to4DP(_squareDuty),
                    to4DP(_dutySweep),
                    to4DP(_repeatSpeed),
                    to4DP(_phaserOffset),
                    to4DP(_phaserSweep),
                    to4DP(_lpFilterCutoff),
                    to4DP(_lpFilterCutoffSweep),
                    to4DP(_lpFilterResonance),
                    to4DP(_hpFilterCutoff),
                    to4DP(_hpFilterCutoffSweep),
                    to4DP(_masterVolume)
                ];
    		}
            return getSettings();
        }

        playNextSound = () => {
            sound = getSound();
            var player = new Audio();
            player.src = jsfxr(sound);
            player.play();
            setTimeout(playNextSound, (sound[2]*1000) + 50);
        }

        playNextSound();

	</script>
</body>
</html>
