<!DOCTYPE html>
<html>
<head>
	<title>Test Path Generation</title>
</head>
<body>
    <a id='prev'></a>
    <span id='curr'></span>
    <a id='next'></a>

	<div id='results'><canvas style='border:1px #f00 solid' id='testCanvas' width=500 height=500 /></div>
	<script src='../js/renderer.js'></script>
    <script type="text/javascript">
        seed = 100
        if (document.location.search.length) {
            seed = parseInt(document.location.search.substr(1), 10);
        }
        $.write($.gid('prev'), seed-1);
        $.gid('prev').href = 'path.html?' + (seed-1)
        $.write($.gid('curr'), seed);
        $.write($.gid('next'), seed+1);
        $.gid('next').href = 'path.html?' + (seed+1)

        w = 500, h = 500

		// generate a path
		ctx = $.gc($.gid('testCanvas'));
		r = $.gen(seed)

        is_symmetrical = r() < 0.5
        num_ships = $.btwn(r, 2, 7)
        if (is_symmetrical) {
            num_ships = $.f(num_ships / 2)
        }

        shh = 50
        shw = 50
        uh = w - (shh * num_ships) - 5
        uw = w - shw - 5
        num_points = $.btwn(r, 3, 5)

        sx = w + 20
        sy = $.btwn(r, 5, uh)
        let pts = [sx, sy]
        for (incr = 1; incr <= num_points; incr++) {
            sa = r() < 0.5
            cx = pts[pts.length - 2]
            cy = pts[pts.length - 1]
            nx = incr === num_points ? -2 * shw : $.btwn(r, uw/2, uw)
            ny = $.btwn(r, 5, uh)
            if (sa) {
                ctrl = [
                    $.btwn(r, cx, nx),
                    $.btwn(r, cy, ny)
                ]
            }
            dst = $.dist([cx, cy], [nx, ny])

            time = (r() * 2 + 2) * 100

            for (i = 0; i <= time; i+= 4) {
                np = sa ? $.ap([cx,cy], ctrl, [nx,ny], i/time) : $.lp([cx,cy], [nx,ny], i/100)
                pts = [...pts, ...np];
            }
        }

        ships = [];
        for (let sn = 0; sn < num_ships; sn++) {
            let npts = $.opts(pts, 0, shh * sn)
            ships.push(npts);
            if (is_symmetrical) ships.push($.ipts(npts, h))
        }

        ships.forEach((spts, idx) => {
            len = spts.length;
            spts.forEach((pt, idx) => {
                p = idx / len
                shade = _.c[$.f(p * _.c.length)]
                if (shade === 'f') shade = 'e'
                if (idx % 2 === 0) {
                    $.dc(ctx, {x: pt, y: spts[idx+1], r: 2, col: `#${shade}${shade}${shade}`})
                    ctx.fill();
                }
            })
        })

	</script>
</body>
</html>
