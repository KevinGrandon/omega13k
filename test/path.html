<!DOCTYPE html>
<html>
<head>
	<title>Test Path Generation</title>
</head>
<body>
    <a id='prev'></a>
    <span id='curr'></span>
    <a id='next'></a>

	<div id='results'><canvas style='border:1px #f00 solid' id='testCanvas' width=800 height=600 /></div>
	<script src='../js/lib/jsfxr.js'></script>
	<script src="../js/init.js"></script>
	<script src="../js/const.js"></script>

	<script src="../js/dom.js"></script>
	<script src="../js/drawing.js"></script>
	<script src="../js/geometry.js"></script>
	<script src="../js/math.js"></script>
	<script src="../js/rand.js"></script>
	<script src="../js/path.js"></script>
    <script type="text/javascript">
        seed = 100
        if (document.location.search.length) {
            seed = parseInt(document.location.search.substr(1), 10);
        }
        $.write($.getElementById('prev'), seed-1);
        $.getElementById('prev').href = 'path.html?' + (seed-1)
        $.write($.getElementById('curr'), seed);
        $.write($.getElementById('next'), seed+1);
        $.getElementById('next').href = 'path.html?' + (seed+1)

		// generate a path
		ctx = $.getContext($.getElementById('testCanvas'));
		r = $.getRandomNumberGenerator(seed)

		var CIRCLES_PER_SECOND = 50;
		var MILLISECONDS_PER_CIRCLE = 1000 / CIRCLES_PER_SECOND;

		let pathData = $.generateRandomPath(r, 0);

		for (var i = 0; i < pathData.length; i++) {
			var path = pathData[i];

			var minTime = path[0][PathSegmentIndex.START_TIME];
			var maxTime = path[path.length - 1][PathSegmentIndex.END_TIME];
			var totalTime = maxTime - minTime;

			for (var j = 0; j < path.length; j++) {
				var segment = path[j];
				var [startTime, endTime, startPoint, endPoint, controlPoint] = segment;
				var deltaT = endTime - startTime;
				for (var k = startTime; k < endTime; k += MILLISECONDS_PER_CIRCLE) {
					var percentage = (k - startTime) / deltaT;
					let pt;
					if (controlPoint) {
						pt = $.arcPoint(startPoint, controlPoint, endPoint, percentage)
					} else {
						pt = $.linePoint(startPoint, endPoint, percentage)
					}


					let idx = $.floor((k - minTime) / totalTime * $.USABLE_COLORS.length);
					let shade = $.USABLE_COLORS[idx];
					$.drawCircle(ctx, [`#${shade}${shade}${shade}`, 2, pt])
				}
			}
		}

	</script>
</body>
</html>
